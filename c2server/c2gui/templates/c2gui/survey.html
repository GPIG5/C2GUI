<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Playfair+Display:700,900|Fira+Sans:400,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="{% static 'css/survey.css' %}"/>
    <script src="{% static 'js/jquery-2.1.4.js' %}"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <title>C2 GUI - Survey Map</title>
</head>

<body>
  <canvas id="survey-map" width="1000px", height="842px">
  </canvas>
<script src="{% static 'js/jquery.mobile.custom.min.js' %}"></script>

<script type="text/javascript">
  $(document).ready(function () {
    var c = document.getElementById("survey-map");
    var ctx = c.getContext("2d");
    var bg = new Image;
    bg.src = "{% static 'img/yorktex.jpg' %}";
    bg.onload = function () {
      ctx.drawImage(bg, 0, 0, c.width, c.height);
      // Now filter this.
      brightness(c, ctx, 0.3);
    };
    // Do XHR requests to get images to draw.
    $.ajax({
      url: "retrieve_survey",
      dataType: "json",
      context: document.body
    }).done(function(data) {
      data['data'].forEach(function(item) {
        draw_survey(c, ctx, item);
      });
    });
  });

  function brightness(c, ctx, perc) {
    pixels = ctx.getImageData(0,0,c.width,c.height);
    var d = pixels.data;
    for (var i=0; i<d.length; i+=4) {
      d[i] *= perc;
      d[i+1] *= perc;
      d[i+2] *= perc;
    }
    ctx.putImageData(pixels, 0, 0);
  }

  function draw_survey(c, ctx, image) {
    console.log(image);
  }
</script>
</body>
</html>
